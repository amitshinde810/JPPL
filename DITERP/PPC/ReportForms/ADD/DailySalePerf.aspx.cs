using System;
using System.Web.UI;
using CrystalDecisions.CrystalReports.Engine;
using System.Data;
using System.Web.UI.HtmlControls;

public partial class PPC_ReportForms_ADD_DailySalePerf : System.Web.UI.Page
{
    DatabaseAccessLayer DL_DBAccess = null;
    string Type = "";

    #region Page_Load
    protected void Page_Load(object sender, EventArgs e)
    {
        HtmlGenericControl home = (HtmlGenericControl)this.Page.Master.FindControl("Menus").FindControl("PPC");
        home.Attributes["class"] = "active";
        HtmlGenericControl home1 = (HtmlGenericControl)this.Page.Master.FindControl("Menus").FindControl("PPCMV");
        home1.Attributes["class"] = "active";
    }
    #endregion Page_Load

    #region Page_Init
    protected void Page_Init(object sender, EventArgs e)
    {
        try
        {
            string Title = Request.QueryString[0];
            string Date = Request.QueryString[1].ToString();
            //string GroupCode = Request.QueryString[2].ToString();
            string StrCond = Request.QueryString[2].ToString();
            Type = Request.QueryString[3].ToString();
            string WeekCond = Request.QueryString[4].ToString();
            Page.Title = Title;
            GenerateReport(Title, Date, StrCond, Type, WeekCond);
        }
        catch (Exception)
        {
        }
    }
    #endregion

    #region GenerateReport
    private void GenerateReport(string Title, string Date, string StrCond, string Type, string WeekCond)
    {
        try
        {
            DL_DBAccess = new DatabaseAccessLayer();
            DateTime dtMonth = new DateTime();
            dtMonth = Convert.ToDateTime(Date);
            string Query = "", ReportName = "";

            if (Type.ToString() == "DailySalePerf")
            {
                Title = "Daily Sales Performance Report";
                lblTitle.Text = "Daily Sales Performance Report";
               
                //Query = " SELECT DISTINCT GP_NAME,CS_P_CODE, CS_I_CODE AS DSED_I_CODE,I_CODENO AS [PART_NO],I_NAME+' '+I_CODENO as [COMPONENT],isnull(I_INV_RATE,0) as [Rate], ISNULL((SELECT DISTINCT isnull(DSED.DSED_ACTUAL_QTY,0) as [TODAYS_DESP_PLAN] FROM DAILY_SALE_ENTRY_DETAIL DSED inner join DAILY_SALE_ENTRY_MASTER DSEM on DSED_DSEM_CODE=DSEM_CODE    WHERE  DSEM_MONTH='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND DSEM.ES_DELETE=0   AND  DSED_I_CODE=CS_I_CODE  ),0) as [TODAYS_DESP_PLAN] , isnull((select sum(ISNULL(CWP_SALE_QTY,0)) FROM CUSTOMER_WEEKLY_PLAN WHERE CWP_I_CODE=CS_I_CODE AND CWP_WEEK=1   AND datepart(MM,CWP_DATE)='" + dtMonth.Month + "' AND  datepart(YYYY,CWP_DATE)='" + dtMonth.Year + "'  ),0) as WeekQty,   sum(ISNULL(CS_SCHEDULE_QTY,0))  as QTY,  isnull(( SELECT  TOP (1) ISNULL(P_NAME,'') FROM   PARTY_MASTER   where   ES_DELETE=0 AND P_CODE=CS_P_CODE),0) as P_NAME,  isnull((select sum(isnull(DSED_ACTUAL_QTY,0)) from DAILY_SALE_ENTRY_DETAIL inner join DAILY_SALE_ENTRY_MASTER on DSED_DSEM_CODE=DSEM_CODE where DSED_I_CODE=CS_I_CODE and DSEM_MONTH= DATEADD(DAY,-1,'" + dtMonth.ToString("dd/MMM/yyyy") + "')),0) as [PLAN1],  isnull((SELECT SUM(IND_INQTY) FROM INVOICE_MASTER,INVOICE_DETAIL where INM_CODE=IND_INM_CODE AND INM_TYPE='TAXINV' AND INM_SUPPLEMENTORY=0 AND INM_IS_SUPPLIMENT=0 AND IND_I_CODE=CS_I_CODE and INM_DATE= DATEADD(DAY,-1,'" + dtMonth.ToString("dd/MMM/yyyy") + "')),0) as [ACTUAL],  isnull((select sum(isnull(DSED_ACTUAL_QTY,0)) from DAILY_SALE_ENTRY_DETAIL inner join DAILY_SALE_ENTRY_MASTER on DSED_DSEM_CODE=DSEM_CODE where DSED_I_CODE=CS_I_CODE and DSEM_MONTH BETWEEN '01-Oct-2018' AND '" + dtMonth.ToString("dd/MMM/yyyy") + "' ),0) as [PLAN_ORG], isnull((SELECT SUM(IND_INQTY) FROM INVOICE_MASTER,INVOICE_DETAIL where INM_CODE=IND_INM_CODE AND INM_TYPE='TAXINV' AND INM_SUPPLEMENTORY=0 AND INM_IS_SUPPLIMENT=0 AND IND_I_CODE=CS_I_CODE and INM_DATE BETWEEN  '" + dtMonth.ToString("01/MMM/yyyy") + "' AND '" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as [ACTUAL_ORG]  into #Temp0  FROM CUSTOMER_SCHEDULE INNER JOIN ITEM_MASTER ON CUSTOMER_SCHEDULE.CS_I_CODE = ITEM_MASTER.I_CODE INNER JOIN DAILY_SALE_ENTRY_DETAIL AS DSED INNER JOIN DAILY_SALE_ENTRY_MASTER AS DSEM ON DSED.DSED_DSEM_CODE = DSEM.DSEM_CODE INNER JOIN PRODUCT_MASTER AS PROD ON PROD.PROD_I_CODE = DSED.DSED_I_CODE INNER JOIN GROUP_MASTER AS GP ON PROD.PROD_GP_CODE = GP.GP_CODE ON ITEM_MASTER.I_CODE = PROD.PROD_I_CODE  WHERE     (DSEM.ES_DELETE = 0) AND (ITEM_MASTER.ES_DELETE = 0) AND (GP.ES_DELETE = 0) AND (PROD.ES_DELETE = 0) AND datepart(MM,CS_DATE)='" + dtMonth.Month + "' AND  datepart(YYYY,CS_DATE)='" + dtMonth.Year + "'  AND    DSEM.DSEM_MONTH  = '" + dtMonth.ToString("dd/MMM/yyyy") + "' GROUP BY GP_NAME,CS_I_CODE,I_CODENO,I_NAME,I_INV_RATE,CS_P_CODE  SELECT SSED_I_CODE,SUM(SSED_SHORT_QTY) AS ON_SSED_SHORT_QTY,SUM(isnull(SSED_FDY,0)) AS FDY_ON,SUM(isnull(SSED_MC_SHOP,0)) AS MC_SHOP_ON,SUM(isnull(SSED_QA,0)) AS QA_ON,SUM(isnull(SSED_MAINT,0)) AS MAINT_ON,SUM(isnull(SSED_TOOL_ROOM,0)) AS TOOL_ROOM_ON,SUM(isnull(SSED_PPC,0)) AS PPC_ON,SUM(isnull(SSED_PURCHASE,0)) AS PURCHASE_ON,SUM(isnull(SSED_OUTSIDE_VENDOR,0)) AS OUTSIDE_VEN_ON,SUM(isnull(SSED_CSN,0)) AS CSN_ON into #Temp1  FROM SHORT_SALE_ENTRY_MASTER,SHORT_SALE_ENTRY_DETAIL where SSEM_CODE =SSED_SSEM_CODE AND ES_DELETE=0 AND SSEM_MONTH='" + dtMonth.ToString("dd/MMM/yyyy") + "' GROUP BY SSED_I_CODE SELECT SSED_I_CODE,SUM(SSED_SHORT_QTY) AS COMM_SSED_SHORT_QTY,SUM(isnull(SSED_FDY,0)) AS FDY_CUM,SUM(isnull(SSED_MC_SHOP,0)) AS MC_SHOP_CUM,SUM(isnull(SSED_QA,0)) AS QA_CUM,SUM(isnull(SSED_MAINT,0)) AS MAINT_CUM,SUM(isnull(SSED_TOOL_ROOM,0)) AS TOOL_ROOM_CUM,SUM(isnull(SSED_PPC,0)) AS PPC_CUM,SUM(isnull(SSED_PURCHASE,0)) AS PURCHASE_CUM,SUM(isnull(SSED_OUTSIDE_VENDOR,0)) AS OUTSIDE_VEN_CUM,SUM(isnull(SSED_CSN,0)) AS CSN_CUM into #Temp2 FROM SHORT_SALE_ENTRY_MASTER,SHORT_SALE_ENTRY_DETAIL where SSEM_CODE =SSED_SSEM_CODE AND ES_DELETE=0 AND SSEM_MONTH BETWEEN '" + dtMonth.ToString("01/MMM/yyyy") + "' AND '" + dtMonth.ToString("dd/MMM/yyyy") + "' GROUP BY SSED_I_CODE  SELECT #Temp0.GP_NAME as [GROUP],#Temp0.P_NAME as [P_NAME],    #Temp0.DSED_I_CODE, #Temp0.PART_NO, #Temp0.COMPONENT, Isnull(#Temp0.Rate,0) as Rate, Isnull(#Temp0.TODAYS_DESP_PLAN,0) as TODAYS_DESP_PLAN,   Isnull(#Temp0.WeekQty,0) as WeekQty, Isnull(#Temp0.QTY,0) as QTY,Isnull(#Temp0.QTY,0)/25 as AV_DAY, Isnull(#Temp0.PLAN1,0) as [PLAN], Isnull(#Temp0.ACTUAL,0) as ACTUAL,CASE WHEN Isnull(#Temp0.PLAN1,0)- Isnull(#Temp0.ACTUAL,0) < 0 THEN 0 ELSE Isnull(#Temp0.PLAN1,0)- Isnull(#Temp0.ACTUAL,0) END AS [BACLOK],Isnull(#Temp0.PLAN_ORG,0) as PLAN_ORG, Isnull(#Temp0.ACTUAL_ORG,0) as ACTUAL_ORG,CASE WHEN Isnull(#Temp0.PLAN_ORG,0)- Isnull(#Temp0.ACTUAL_ORG,0) < 0 THEN 0 ELSE Isnull(#Temp0.PLAN_ORG,0)- Isnull(#Temp0.ACTUAL_ORG,0) END AS [BACLOK_ORG],CASE WHEN Isnull(#Temp0.QTY,0)- Isnull(#Temp0.ACTUAL_ORG,0) < 0 THEN 0 ELSE Isnull(#Temp0.QTY,0)- Isnull(#Temp0.ACTUAL_ORG,0) END AS [BALANCE_FOR_DESP],#Temp1.SSED_I_CODE, Isnull(#Temp1.ON_SSED_SHORT_QTY,0) as ON_SSED_SHORT_QTY, Isnull(#Temp1.FDY_ON,0) as FDY_ON, Isnull(#Temp1.MC_SHOP_ON,0) as MC_SHOP_ON, Isnull(#Temp1.QA_ON,0) as QA_ON, Isnull(#Temp1.MAINT_ON,0) as MAINT_ON, Isnull(#Temp1.TOOL_ROOM_ON,0) as TOOL_ROOM_ON, Isnull(#Temp1.PPC_ON,0) as PPC_ON, Isnull(#Temp1.PURCHASE_ON,0) as PURCHASE_ON, Isnull(#Temp1.OUTSIDE_VEN_ON,0) as OUTSIDE_VEN_ON, Isnull(#Temp1.CSN_ON,0) as CSN_ON,#Temp2.SSED_I_CODE, Isnull(#Temp2.COMM_SSED_SHORT_QTY,0) as COMM_SSED_SHORT_QTY, Isnull(#Temp2.FDY_CUM,0) as FDY_CUM, Isnull(#Temp2.MC_SHOP_CUM,0) as MC_SHOP_CUM, Isnull(#Temp2.QA_CUM,0) as QA_CUM, Isnull(#Temp2.MAINT_CUM,0) as MAINT_CUM, Isnull(#Temp2.TOOL_ROOM_CUM,0) as TOOL_ROOM_CUM, Isnull(#Temp2.PPC_CUM,0) as PPC_CUM, Isnull(#Temp2.PURCHASE_CUM,0) as PURCHASE_CUM, Isnull(#Temp2.OUTSIDE_VEN_CUM,0) as OUTSIDE_VEN_CUM, Isnull(#Temp2.CSN_CUM,0) as CSN_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.QTY,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_QTY,case when #Temp0.Rate=0 then 0 else isnull(((isnull(#Temp0.QTY,0)/25) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_AV_DAY,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.PLAN1,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PLAN,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.ACTUAL,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_ACTUAL,case when #Temp0.Rate<0 then  0 when Isnull(#Temp0.PLAN1,0)- Isnull(#Temp0.ACTUAL,0) < 0 THEN 0 else isnull((isnull((Isnull(#Temp0.PLAN1,0)- Isnull(#Temp0.ACTUAL,0)),0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_BACLOK,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.PLAN_ORG,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PLAN_ORG,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.ACTUAL_ORG,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_ACTUAL_ORG,case when #Temp0.Rate<0 then  0 when Isnull(#Temp0.PLAN_ORG,0)- Isnull(#Temp0.ACTUAL_ORG,0) < 0 THEN 0 else isnull((isnull((Isnull(#Temp0.PLAN_ORG,0)- Isnull(#Temp0.ACTUAL_ORG,0)),0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_BACLOK_ORG,case when #Temp0.Rate<0 then  0 when Isnull(#Temp0.QTY,0)- Isnull(#Temp0.ACTUAL_ORG,0) < 0 THEN 0 else isnull((isnull((Isnull(#Temp0.QTY,0)- Isnull(#Temp0.ACTUAL_ORG,0)),0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_BALANCE_FOR_DESP,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.ON_SSED_SHORT_QTY,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_ON_SSED_SHORT_QTY,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.FDY_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_FDY_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.MC_SHOP_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_MC_SHOP_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.QA_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_QA_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.MAINT_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_MAINT_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.TOOL_ROOM_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_TOOL_ROOM_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.PPC_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PPC_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.PURCHASE_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PURCHASE_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.OUTSIDE_VEN_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_OUTSIDE_VEN_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.CSN_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_CSN_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.COMM_SSED_SHORT_QTY,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_COMM_SSED_SHORT_QTY,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.FDY_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_FDY_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.MC_SHOP_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_MC_SHOP_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.QA_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_QA_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.MAINT_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_MAINT_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.TOOL_ROOM_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_TOOL_ROOM_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.PPC_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PPC_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.PURCHASE_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PURCHASE_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.OUTSIDE_VEN_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_OUTSIDE_VEN_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.CSN_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_CSN_CUM FROM #Temp0 left outer join #temp1 on #Temp0.DSED_I_CODE=#Temp1.SSED_I_CODE Left Outer Join #temp2 ON #Temp0.DSED_I_CODE=#Temp2.SSED_I_CODE DROP TABLE #Temp0 DROP TABLE #Temp1 DROP TABLE #Temp2";

                Query = " SELECT DISTINCT GP_NAME,CS_P_CODE, CS_I_CODE AS DSED_I_CODE,I_CODENO AS [PART_NO],I_NAME+' '+I_CODENO as [COMPONENT],isnull(I_INV_RATE,0) as [Rate], ISNULL((SELECT DISTINCT isnull(SUM(DSED.DSED_ACTUAL_QTY),0) as [TODAYS_DESP_PLAN] FROM DAILY_SALE_ENTRY_DETAIL DSED inner join DAILY_SALE_ENTRY_MASTER DSEM on DSED_DSEM_CODE=DSEM_CODE    WHERE  DSEM_MONTH='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND DSEM.ES_DELETE=0   AND  DSED_I_CODE=CS_I_CODE  ),0) as [TODAYS_DESP_PLAN] , isnull((select sum(ISNULL(CWP_SALE_QTY,0)) FROM CUSTOMER_WEEKLY_PLAN WHERE CWP_I_CODE=CS_I_CODE AND CWP_WEEK=1   AND datepart(MM,CWP_DATE)='" + dtMonth.Month + "' AND  datepart(YYYY,CWP_DATE)='" + dtMonth.Year + "'  ),0) as WeekQty,   sum(ISNULL(CS_SCHEDULE_QTY,0))  as QTY,  isnull(( SELECT  TOP (1) ISNULL(P_NAME,'') FROM   PARTY_MASTER   where   ES_DELETE=0 AND P_CODE=CS_P_CODE),0) as P_NAME,  isnull((select sum(isnull(DSED_ACTUAL_QTY,0)) from DAILY_SALE_ENTRY_DETAIL inner join DAILY_SALE_ENTRY_MASTER on DSED_DSEM_CODE=DSEM_CODE where DSED_I_CODE=CS_I_CODE and DSEM_MONTH= DATEADD(DAY,-1,'" + dtMonth.ToString("dd/MMM/yyyy") + "')),0) as [PLAN1],  isnull((SELECT SUM(IND_INQTY) FROM INVOICE_MASTER,INVOICE_DETAIL where INM_CODE=IND_INM_CODE AND INM_TYPE='TAXINV' AND INM_SUPPLEMENTORY=0 AND INM_IS_SUPPLIMENT=0 AND IND_I_CODE=CS_I_CODE and INM_DATE= DATEADD(DAY,-1,'" + dtMonth.ToString("dd/MMM/yyyy") + "')),0) as [ACTUAL],  isnull((select sum(isnull(DSED_ACTUAL_QTY,0)) from DAILY_SALE_ENTRY_DETAIL inner join DAILY_SALE_ENTRY_MASTER on DSED_DSEM_CODE=DSEM_CODE where DSED_I_CODE=CS_I_CODE and DSEM_MONTH BETWEEN '01-Oct-2018' AND '" + dtMonth.ToString("dd/MMM/yyyy") + "' ),0) as [PLAN_ORG], isnull((SELECT SUM(IND_INQTY) FROM INVOICE_MASTER,INVOICE_DETAIL where INM_CODE=IND_INM_CODE AND INM_TYPE='TAXINV' AND INM_SUPPLEMENTORY=0 AND INM_IS_SUPPLIMENT=0 AND IND_I_CODE=CS_I_CODE and INM_DATE BETWEEN  '" + dtMonth.ToString("01/MMM/yyyy") + "' AND '" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as [ACTUAL_ORG]  into #Temp0   FROM         GROUP_MASTER AS GP INNER JOIN PRODUCT_MASTER AS PROD ON GP.GP_CODE = PROD.PROD_GP_CODE INNER JOIN CUSTOMER_SCHEDULE INNER JOIN ITEM_MASTER ON CUSTOMER_SCHEDULE.CS_I_CODE = ITEM_MASTER.I_CODE ON PROD.PROD_I_CODE = ITEM_MASTER.I_CODE INNER JOIN PARTY_MASTER ON P_CODE=CS_P_CODE  WHERE    CUSTOMER_SCHEDULE.ES_DELETE =0 AND      (ITEM_MASTER.ES_DELETE = 0) AND (GP.ES_DELETE = 0) AND (PROD.ES_DELETE = 0) AND datepart(MM,CS_DATE)='" + dtMonth.Month + "' AND  datepart(YYYY,CS_DATE)='" + dtMonth.Year + "'    GROUP BY GP_NAME,CS_I_CODE,I_CODENO,I_NAME,I_INV_RATE,CS_P_CODE  SELECT SSED_I_CODE,SUM(SSED_SHORT_QTY) AS ON_SSED_SHORT_QTY,SUM(isnull(SSED_FDY,0)) AS FDY_ON,SUM(isnull(SSED_MC_SHOP,0)) AS MC_SHOP_ON,SUM(isnull(SSED_QA,0)) AS QA_ON,SUM(isnull(SSED_MAINT,0)) AS MAINT_ON,SUM(isnull(SSED_TOOL_ROOM,0)) AS TOOL_ROOM_ON,SUM(isnull(SSED_PPC,0)) AS PPC_ON,SUM(isnull(SSED_PURCHASE,0)) AS PURCHASE_ON,SUM(isnull(SSED_OUTSIDE_VENDOR,0)) AS OUTSIDE_VEN_ON,SUM(isnull(SSED_CSN,0)) AS CSN_ON into #Temp1  FROM SHORT_SALE_ENTRY_MASTER,SHORT_SALE_ENTRY_DETAIL where SSEM_CODE =SSED_SSEM_CODE AND ES_DELETE=0 AND SSEM_MONTH='" + dtMonth.ToString("dd/MMM/yyyy") + "' GROUP BY SSED_I_CODE SELECT SSED_I_CODE,SUM(SSED_SHORT_QTY) AS COMM_SSED_SHORT_QTY,SUM(isnull(SSED_FDY,0)) AS FDY_CUM,SUM(isnull(SSED_MC_SHOP,0)) AS MC_SHOP_CUM,SUM(isnull(SSED_QA,0)) AS QA_CUM,SUM(isnull(SSED_MAINT,0)) AS MAINT_CUM,SUM(isnull(SSED_TOOL_ROOM,0)) AS TOOL_ROOM_CUM,SUM(isnull(SSED_PPC,0)) AS PPC_CUM,SUM(isnull(SSED_PURCHASE,0)) AS PURCHASE_CUM,SUM(isnull(SSED_OUTSIDE_VENDOR,0)) AS OUTSIDE_VEN_CUM,SUM(isnull(SSED_CSN,0)) AS CSN_CUM into #Temp2 FROM SHORT_SALE_ENTRY_MASTER,SHORT_SALE_ENTRY_DETAIL where SSEM_CODE =SSED_SSEM_CODE AND ES_DELETE=0 AND SSEM_MONTH BETWEEN '" + dtMonth.ToString("01/MMM/yyyy") + "' AND '" + dtMonth.ToString("dd/MMM/yyyy") + "' GROUP BY SSED_I_CODE  SELECT #Temp0.GP_NAME as [GROUP],#Temp0.P_NAME as [P_NAME],    #Temp0.DSED_I_CODE, #Temp0.PART_NO, #Temp0.COMPONENT, Isnull(#Temp0.Rate,0) as Rate, Isnull(#Temp0.TODAYS_DESP_PLAN,0) as TODAYS_DESP_PLAN,   Isnull(#Temp0.WeekQty,0) as WeekQty, Isnull(#Temp0.QTY,0) as QTY,Isnull(#Temp0.QTY,0)/25 as AV_DAY, Isnull(#Temp0.PLAN1,0) as [PLAN], Isnull(#Temp0.ACTUAL,0) as ACTUAL,CASE WHEN Isnull(#Temp0.PLAN1,0)- Isnull(#Temp0.ACTUAL,0) < 0 THEN 0 ELSE Isnull(#Temp0.PLAN1,0)- Isnull(#Temp0.ACTUAL,0) END AS [BACLOK],Isnull(#Temp0.PLAN_ORG,0) as PLAN_ORG, Isnull(#Temp0.ACTUAL_ORG,0) as ACTUAL_ORG,CASE WHEN Isnull(#Temp0.PLAN_ORG,0)- Isnull(#Temp0.ACTUAL_ORG,0) < 0 THEN 0 ELSE Isnull(#Temp0.PLAN_ORG,0)- Isnull(#Temp0.ACTUAL_ORG,0) END AS [BACLOK_ORG],CASE WHEN Isnull(#Temp0.QTY,0)- Isnull(#Temp0.ACTUAL_ORG,0) < 0 THEN 0 ELSE Isnull(#Temp0.QTY,0)- Isnull(#Temp0.ACTUAL_ORG,0) END AS [BALANCE_FOR_DESP],#Temp1.SSED_I_CODE, Isnull(#Temp1.ON_SSED_SHORT_QTY,0) as ON_SSED_SHORT_QTY, Isnull(#Temp1.FDY_ON,0) as FDY_ON, Isnull(#Temp1.MC_SHOP_ON,0) as MC_SHOP_ON, Isnull(#Temp1.QA_ON,0) as QA_ON, Isnull(#Temp1.MAINT_ON,0) as MAINT_ON, Isnull(#Temp1.TOOL_ROOM_ON,0) as TOOL_ROOM_ON, Isnull(#Temp1.PPC_ON,0) as PPC_ON, Isnull(#Temp1.PURCHASE_ON,0) as PURCHASE_ON, Isnull(#Temp1.OUTSIDE_VEN_ON,0) as OUTSIDE_VEN_ON, Isnull(#Temp1.CSN_ON,0) as CSN_ON,#Temp2.SSED_I_CODE, Isnull(#Temp2.COMM_SSED_SHORT_QTY,0) as COMM_SSED_SHORT_QTY, Isnull(#Temp2.FDY_CUM,0) as FDY_CUM, Isnull(#Temp2.MC_SHOP_CUM,0) as MC_SHOP_CUM, Isnull(#Temp2.QA_CUM,0) as QA_CUM, Isnull(#Temp2.MAINT_CUM,0) as MAINT_CUM, Isnull(#Temp2.TOOL_ROOM_CUM,0) as TOOL_ROOM_CUM, Isnull(#Temp2.PPC_CUM,0) as PPC_CUM, Isnull(#Temp2.PURCHASE_CUM,0) as PURCHASE_CUM, Isnull(#Temp2.OUTSIDE_VEN_CUM,0) as OUTSIDE_VEN_CUM, Isnull(#Temp2.CSN_CUM,0) as CSN_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.QTY,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_QTY,case when #Temp0.Rate=0 then 0 else isnull(((isnull(#Temp0.QTY,0)/25) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_AV_DAY,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.PLAN1,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PLAN,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.ACTUAL,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_ACTUAL,case when #Temp0.Rate<0 then  0 when Isnull(#Temp0.PLAN1,0)- Isnull(#Temp0.ACTUAL,0) < 0 THEN 0 else isnull((isnull((Isnull(#Temp0.PLAN1,0)- Isnull(#Temp0.ACTUAL,0)),0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_BACLOK,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.PLAN_ORG,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PLAN_ORG,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp0.ACTUAL_ORG,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_ACTUAL_ORG,case when #Temp0.Rate<0 then  0 when Isnull(#Temp0.PLAN_ORG,0)- Isnull(#Temp0.ACTUAL_ORG,0) < 0 THEN 0 else isnull((isnull((Isnull(#Temp0.PLAN_ORG,0)- Isnull(#Temp0.ACTUAL_ORG,0)),0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_BACLOK_ORG,case when #Temp0.Rate<0 then  0 when Isnull(#Temp0.QTY,0)- Isnull(#Temp0.ACTUAL_ORG,0) < 0 THEN 0 else isnull((isnull((Isnull(#Temp0.QTY,0)- Isnull(#Temp0.ACTUAL_ORG,0)),0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_BALANCE_FOR_DESP,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.ON_SSED_SHORT_QTY,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_ON_SSED_SHORT_QTY,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.FDY_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_FDY_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.MC_SHOP_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_MC_SHOP_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.QA_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_QA_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.MAINT_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_MAINT_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.TOOL_ROOM_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_TOOL_ROOM_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.PPC_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PPC_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.PURCHASE_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PURCHASE_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.OUTSIDE_VEN_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_OUTSIDE_VEN_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp1.CSN_ON,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_CSN_ON,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.COMM_SSED_SHORT_QTY,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_COMM_SSED_SHORT_QTY,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.FDY_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_FDY_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.MC_SHOP_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_MC_SHOP_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.QA_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_QA_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.MAINT_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_MAINT_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.TOOL_ROOM_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_TOOL_ROOM_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.PPC_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PPC_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.PURCHASE_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_PURCHASE_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.OUTSIDE_VEN_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_OUTSIDE_VEN_CUM,case when #Temp0.Rate=0 then 0 else isnull((isnull(#Temp2.CSN_CUM,0) * isnull(#Temp0.Rate,0)),0)/100000 end as Value_CSN_CUM FROM #Temp0 left outer join #temp1 on #Temp0.DSED_I_CODE=#Temp1.SSED_I_CODE Left Outer Join #temp2 ON #Temp0.DSED_I_CODE=#Temp2.SSED_I_CODE DROP TABLE #Temp0 DROP TABLE #Temp1 DROP TABLE #Temp2";
                ReportName = "DailySalePerf";
            }
            else if (Type.ToString() == "DailyFoundryDispVsActual")
            {
                Title = "Foundry Dispatch Plan Vs Actual Report";
                lblTitle.Text = "Foundry Dispatch Plan Vs Actual Report";
                Query = "SELECT * INTO #Temp from (SELECT DISTINCT G.GP_NAME,I.I_CODE,I_CODENO,I_NAME ,isnull((select sum(isnull(CWP_SALE_QTY,0)) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE AND CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) as SALE_PLAN_QTY,ISNULL(SIM_CUST_STOCK,0) as Tot_Stnd_Stock,isnull((select isnull(sum(CWP_CUSTOMER_STOCK),0) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE and CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) AS ActualStockQty,isnull(SIM_FINISH_GOODS,0) as STD_StockInFG,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483642' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock_InFG,isnull(SIM_RFI_STORE,0) as Std_Stock_RFI,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483643' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock,isnull(SIM_RFM_STORE,0) as Std_Stock_RFM,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483645' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_StockRFM,case when CWP_WEEK='1' then 'Week :1' when CWP_WEEK='2' then 'Week :2' when CWP_WEEK='3' then 'Week :3' when CWP_WEEK='4' then 'Week :4' else '0' end As CWP_WEEK,right(convert(varchar,CWP.CWP_DATE,106),8) as CWP_DATE FROM GROUP_MASTER G INNER JOIN STANDARD_INVENTARY_MASTER S ON G.GP_CODE =S.SIM_GP_CODE INNER JOIN ITEM_MASTER I ON S.SIM_I_CODE=I.I_CODE INNER JOIN CUSTOMER_SCHEDULE C ON SIM_I_CODE=C.CS_I_CODE inner join PRODUCT_MASTER PROD on S.SIM_I_CODE=PROD.PROD_I_CODE inner join CUSTOMER_WEEKLY_PLAN CWP ON I.I_CODE=CWP.CWP_I_CODE WHERE " + StrCond + " CWP_WEEK='" + WeekCond + "' AND PROD.PROD_MACHINE_LOC in('INHOUSE','BOTH') and PROD.ES_DELETE=0 and S.ES_DELETE=0 AND CWP.ES_DELETE=0 AND I.ES_DELETE=0 AND G.ES_DELETE=0 AND PROD.ES_DELETE=0 AND S.SIM_COMP_ID='" + Convert.ToInt32(Session["CompanyId"]) + "' and CWP.CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' group by G.GP_NAME,I.I_CODE,I_CODENO,CWP_P_CODE,I_NAME,CWP_WEEK,SIM_CUST_STOCK,SIM_FINISH_GOODS,SIM_RFM_STORE,right(convert(varchar,CWP.CWP_DATE,106),8),SIM_RFI_STORE) AS tEMP select GP_NAME,I_CODE,I_CODENO,I_NAME,case when SALE_PLAN_QTY<0 then 0 else SALE_PLAN_QTY end as SALE_PLAN_QTY,Tot_Stnd_Stock,CASE WHEN ActualStockQty<0 THEN 0 ELSE ActualStockQty END AS ActualStockQty,CWP_WEEK,CWP_DATE,STD_StockInFG,CASE WHEN Actual_Stock_InFG<0 THEN 0 ELSE Actual_Stock_InFG END AS Actual_Stock_InFG,Std_Stock_RFI,CASE WHEN Actual_Stock <0 THEN 0 ELSE Actual_Stock END AS Actual_Stock,Std_Stock_RFM,CASE WHEN Actual_StockRFM<0 THEN 0 ELSE Actual_StockRFM END AS Actual_StockRFM into #Temp2 from #Temp select GP_NAME,I_CODE,I_CODENO,I_NAME,round(isnull(round(isnull(SALE_PLAN_QTY,0),0) + STD_StockInFG - Actual_Stock_InFG,0),0) as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,CWP_DATE as [MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp3 from #Temp2 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else round(isnull(([Dispatch_Plan_Of_Machine]+Std_Stock_RFI-Actual_Stock),0),0) end as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,[MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp4 from #Temp3 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else isnull([Dispatch_Plan_Of_Machine],0) end as [Dispatch_Plan_Of_Machine],CWP_WEEK,[MONTH] as [Month],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFM as Std_Stock_RFI,Actual_StockRFM as Actual_Stock from #Temp4 drop table #Temp drop table #Temp2 drop table #Temp3 drop table #Temp4";
                ReportName = "DailyFoundryDispVsActual";
            }
            else if (Type.ToString() == "DailyMachinePerf")
            {
                Title = "Daily Machine Shop Performance Report";
                lblTitle.Text = "Daily Machine Shop Performance Report";
                Query = "SELECT * INTO #Temp from (SELECT DISTINCT G.GP_NAME,I.I_CODE,I_CODENO,I_NAME,isnull((select sum(isnull(CWP_SALE_QTY,0)) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE AND CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) as SALE_PLAN_QTY,ISNULL(SIM_CUST_STOCK,0) as Tot_Stnd_Stock,isnull((select isnull(sum(CWP_CUSTOMER_STOCK),0) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE and CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) AS ActualStockQty,isnull(SIM_FINISH_GOODS,0) as STD_StockInFG,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483642' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock_InFG,isnull(SIM_RFI_STORE,0) as Std_Stock_RFI,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483643' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock,isnull(SIM_RFM_STORE,0) as Std_Stock_RFM,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483645' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_StockRFM,case when CWP_WEEK='1' then 'Week :1' when CWP_WEEK='2' then 'Week :2' when CWP_WEEK='3' then 'Week :3' when CWP_WEEK='4' then 'Week :4' else '0' end As CWP_WEEK,right(convert(varchar,CWP.CWP_DATE,106),8) as CWP_DATE FROM GROUP_MASTER G INNER JOIN STANDARD_INVENTARY_MASTER S ON G.GP_CODE =S.SIM_GP_CODE INNER JOIN ITEM_MASTER I ON S.SIM_I_CODE=I.I_CODE INNER JOIN CUSTOMER_SCHEDULE C ON SIM_I_CODE=C.CS_I_CODE inner join PRODUCT_MASTER PROD on S.SIM_I_CODE=PROD.PROD_I_CODE inner join CUSTOMER_WEEKLY_PLAN CWP ON I.I_CODE=CWP.CWP_I_CODE WHERE " + StrCond + " CWP_WEEK='" + WeekCond + "' AND PROD.PROD_MACHINE_LOC in('INHOUSE','BOTH') and PROD.ES_DELETE=0 and S.ES_DELETE=0 AND CWP.ES_DELETE=0 AND I.ES_DELETE=0 AND G.ES_DELETE=0 AND PROD.ES_DELETE=0 AND S.SIM_COMP_ID='" + Convert.ToInt32(Session["CompanyId"]) + "' and CWP.CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' group by G.GP_NAME,I.I_CODE,I_CODENO,CWP_P_CODE,I_NAME,CWP_WEEK,SIM_CUST_STOCK,SIM_FINISH_GOODS,SIM_RFM_STORE,right(convert(varchar,CWP.CWP_DATE,106),8),SIM_RFI_STORE) AS tEMP select GP_NAME,I_CODE,I_CODENO,I_NAME,case when SALE_PLAN_QTY<0 then 0 else SALE_PLAN_QTY end as SALE_PLAN_QTY,Tot_Stnd_Stock,CASE WHEN ActualStockQty<0 THEN 0 ELSE ActualStockQty END AS ActualStockQty,CWP_WEEK,CWP_DATE,STD_StockInFG,CASE WHEN Actual_Stock_InFG<0 THEN 0 ELSE Actual_Stock_InFG END AS Actual_Stock_InFG,Std_Stock_RFI,CASE WHEN Actual_Stock <0 THEN 0 ELSE Actual_Stock END AS Actual_Stock,Std_Stock_RFM,CASE WHEN Actual_StockRFM<0 THEN 0 ELSE Actual_StockRFM END AS Actual_StockRFM into #Temp2 from #Temp select GP_NAME,I_CODE,I_CODENO,I_NAME,round(isnull(round(isnull(SALE_PLAN_QTY,0),0) + STD_StockInFG - Actual_Stock_InFG,0),0) as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,CWP_DATE as [MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp3 from #Temp2 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else round(isnull(([Dispatch_Plan_Of_Machine]+Std_Stock_RFI-Actual_Stock),0),0) end as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,[MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp4 from #Temp3 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else isnull([Dispatch_Plan_Of_Machine],0) end as [Dispatch_Plan_Of_Machine],CWP_WEEK,[MONTH] as [Month],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFM as Std_Stock_RFI,Actual_StockRFM as Actual_Stock from #Temp4 drop table #Temp drop table #Temp2 drop table #Temp3 drop table #Temp4";
                ReportName = "DailyMachinePerf";
            }
            else if (Type.ToString() == "DailyFinalInspDispPerf")
            {
                Title = "Daily Final Inspection Dispatch Performance Report";
                lblTitle.Text = "Daily Final Inspection Dispatch Performance Report";
                Query = "SELECT * INTO #Temp from (SELECT DISTINCT G.GP_NAME,I.I_CODE,I_CODENO,I_NAME,isnull((select sum(isnull(CWP_SALE_QTY,0)) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE AND CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) as SALE_PLAN_QTY,ISNULL(SIM_CUST_STOCK,0) as Tot_Stnd_Stock,isnull((select isnull(sum(CWP_CUSTOMER_STOCK),0) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE and CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) AS ActualStockQty,isnull(SIM_FINISH_GOODS,0) as STD_StockInFG,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483642' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock_InFG,isnull(SIM_RFI_STORE,0) as Std_Stock_RFI,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483643' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock,isnull(SIM_RFM_STORE,0) as Std_Stock_RFM,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483645' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_StockRFM,case when CWP_WEEK='1' then 'Week :1' when CWP_WEEK='2' then 'Week :2' when CWP_WEEK='3' then 'Week :3' when CWP_WEEK='4' then 'Week :4' else '0' end As CWP_WEEK,right(convert(varchar,CWP.CWP_DATE,106),8) as CWP_DATE FROM GROUP_MASTER G INNER JOIN STANDARD_INVENTARY_MASTER S ON G.GP_CODE =S.SIM_GP_CODE INNER JOIN ITEM_MASTER I ON S.SIM_I_CODE=I.I_CODE INNER JOIN CUSTOMER_SCHEDULE C ON SIM_I_CODE=C.CS_I_CODE inner join PRODUCT_MASTER PROD on S.SIM_I_CODE=PROD.PROD_I_CODE inner join CUSTOMER_WEEKLY_PLAN CWP ON I.I_CODE=CWP.CWP_I_CODE WHERE " + StrCond + " CWP_WEEK='" + WeekCond + "' AND PROD.PROD_MACHINE_LOC in('INHOUSE','BOTH') and PROD.ES_DELETE=0 and S.ES_DELETE=0 AND CWP.ES_DELETE=0 AND I.ES_DELETE=0 AND G.ES_DELETE=0 AND PROD.ES_DELETE=0 AND S.SIM_COMP_ID='" + Convert.ToInt32(Session["CompanyId"]) + "' and CWP.CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' group by G.GP_NAME,I.I_CODE,I_CODENO,CWP_P_CODE,I_NAME,CWP_WEEK,SIM_CUST_STOCK,SIM_FINISH_GOODS,SIM_RFM_STORE,right(convert(varchar,CWP.CWP_DATE,106),8),SIM_RFI_STORE) AS tEMP select GP_NAME,I_CODE,I_CODENO,I_NAME,case when SALE_PLAN_QTY<0 then 0 else SALE_PLAN_QTY end as SALE_PLAN_QTY,Tot_Stnd_Stock,CASE WHEN ActualStockQty<0 THEN 0 ELSE ActualStockQty END AS ActualStockQty,CWP_WEEK,CWP_DATE,STD_StockInFG,CASE WHEN Actual_Stock_InFG<0 THEN 0 ELSE Actual_Stock_InFG END AS Actual_Stock_InFG,Std_Stock_RFI,CASE WHEN Actual_Stock <0 THEN 0 ELSE Actual_Stock END AS Actual_Stock,Std_Stock_RFM,CASE WHEN Actual_StockRFM<0 THEN 0 ELSE Actual_StockRFM END AS Actual_StockRFM into #Temp2 from #Temp select GP_NAME,I_CODE,I_CODENO,I_NAME,round(isnull(round(isnull(SALE_PLAN_QTY,0),0) + STD_StockInFG - Actual_Stock_InFG,0),0) as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,CWP_DATE as [MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp3 from #Temp2 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else round(isnull(([Dispatch_Plan_Of_Machine]+Std_Stock_RFI-Actual_Stock),0),0) end as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,[MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp4 from #Temp3 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else isnull([Dispatch_Plan_Of_Machine],0) end as [Dispatch_Plan_Of_Machine],CWP_WEEK,[MONTH] as [Month],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFM as Std_Stock_RFI,Actual_StockRFM as Actual_Stock from #Temp4 drop table #Temp drop table #Temp2 drop table #Temp3 drop table #Temp4";
                ReportName = "DailyFinalInspDispPerf";
            }
            else if (Type.ToString() == "DailyVendorInwardPerf")
            {
                Title = "Daily Vendor Inwarding Performance Report";
                lblTitle.Text = "Daily Vendor Inwarding Performance Report";
                Query = "SELECT * INTO #Temp from (SELECT DISTINCT G.GP_NAME,I.I_CODE,I_CODENO,I_NAME,isnull((select sum(isnull(CWP_SALE_QTY,0)) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE AND CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) as SALE_PLAN_QTY,ISNULL(SIM_CUST_STOCK,0) as Tot_Stnd_Stock,isnull((select isnull(sum(CWP_CUSTOMER_STOCK),0) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE and CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) AS ActualStockQty,isnull(SIM_FINISH_GOODS,0) as STD_StockInFG,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483642' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock_InFG,isnull(SIM_RFI_STORE,0) as Std_Stock_RFI,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483643' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock,isnull(SIM_RFM_STORE,0) as Std_Stock_RFM,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483645' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_StockRFM,case when CWP_WEEK='1' then 'Week :1' when CWP_WEEK='2' then 'Week :2' when CWP_WEEK='3' then 'Week :3' when CWP_WEEK='4' then 'Week :4' else '0' end As CWP_WEEK,right(convert(varchar,CWP.CWP_DATE,106),8) as CWP_DATE FROM GROUP_MASTER G INNER JOIN STANDARD_INVENTARY_MASTER S ON G.GP_CODE =S.SIM_GP_CODE INNER JOIN ITEM_MASTER I ON S.SIM_I_CODE=I.I_CODE INNER JOIN CUSTOMER_SCHEDULE C ON SIM_I_CODE=C.CS_I_CODE inner join PRODUCT_MASTER PROD on S.SIM_I_CODE=PROD.PROD_I_CODE inner join CUSTOMER_WEEKLY_PLAN CWP ON I.I_CODE=CWP.CWP_I_CODE WHERE " + StrCond + " CWP_WEEK='" + WeekCond + "' AND PROD.PROD_MACHINE_LOC in('INHOUSE','BOTH') and PROD.ES_DELETE=0 and S.ES_DELETE=0 AND CWP.ES_DELETE=0 AND I.ES_DELETE=0 AND G.ES_DELETE=0 AND PROD.ES_DELETE=0 AND S.SIM_COMP_ID='" + Convert.ToInt32(Session["CompanyId"]) + "' and CWP.CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' group by G.GP_NAME,I.I_CODE,I_CODENO,CWP_P_CODE,I_NAME,CWP_WEEK,SIM_CUST_STOCK,SIM_FINISH_GOODS,SIM_RFM_STORE,right(convert(varchar,CWP.CWP_DATE,106),8),SIM_RFI_STORE) AS tEMP select GP_NAME,I_CODE,I_CODENO,I_NAME,case when SALE_PLAN_QTY<0 then 0 else SALE_PLAN_QTY end as SALE_PLAN_QTY,Tot_Stnd_Stock,CASE WHEN ActualStockQty<0 THEN 0 ELSE ActualStockQty END AS ActualStockQty,CWP_WEEK,CWP_DATE,STD_StockInFG,CASE WHEN Actual_Stock_InFG<0 THEN 0 ELSE Actual_Stock_InFG END AS Actual_Stock_InFG,Std_Stock_RFI,CASE WHEN Actual_Stock <0 THEN 0 ELSE Actual_Stock END AS Actual_Stock,Std_Stock_RFM,CASE WHEN Actual_StockRFM<0 THEN 0 ELSE Actual_StockRFM END AS Actual_StockRFM into #Temp2 from #Temp select GP_NAME,I_CODE,I_CODENO,I_NAME,round(isnull(round(isnull(SALE_PLAN_QTY,0),0) + STD_StockInFG - Actual_Stock_InFG,0),0) as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,CWP_DATE as [MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp3 from #Temp2 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else round(isnull(([Dispatch_Plan_Of_Machine]+Std_Stock_RFI-Actual_Stock),0),0) end as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,[MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp4 from #Temp3 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else isnull([Dispatch_Plan_Of_Machine],0) end as [Dispatch_Plan_Of_Machine],CWP_WEEK,[MONTH] as [Month],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFM as Std_Stock_RFI,Actual_StockRFM as Actual_Stock from #Temp4 drop table #Temp drop table #Temp2 drop table #Temp3 drop table #Temp4";
                ReportName = "DailyVendorInwardPerf";
            }

            else if (Type.ToString() == "Machine")
            {
                Title = "Castings Required To RFM From Foundry (For Machine Shop)";
                lblTitle.Text = "Castings Required To RFM From Foundry (For Machine Shop)";
                Query = "SELECT * INTO #Temp from (SELECT DISTINCT G.GP_NAME,I.I_CODE,I_CODENO,I_NAME,isnull((select sum(isnull(CWP_SALE_QTY,0)) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE AND CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) as SALE_PLAN_QTY,ISNULL(SIM_CUST_STOCK,0) as Tot_Stnd_Stock,isnull((select isnull(sum(CWP_CUSTOMER_STOCK),0) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE and CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) AS ActualStockQty,isnull(SIM_FINISH_GOODS,0) as STD_StockInFG,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483642' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock_InFG,isnull(SIM_RFI_STORE,0) as Std_Stock_RFI,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483643' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock,isnull(SIM_RFM_STORE,0) as Std_Stock_RFM,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483645' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_StockRFM,case when CWP_WEEK='1' then 'Week :1' when CWP_WEEK='2' then 'Week :2' when CWP_WEEK='3' then 'Week :3' when CWP_WEEK='4' then 'Week :4' else '0' end As CWP_WEEK,right(convert(varchar,CWP.CWP_DATE,106),8) as CWP_DATE FROM GROUP_MASTER G INNER JOIN STANDARD_INVENTARY_MASTER S ON G.GP_CODE =S.SIM_GP_CODE INNER JOIN ITEM_MASTER I ON S.SIM_I_CODE=I.I_CODE INNER JOIN CUSTOMER_SCHEDULE C ON SIM_I_CODE=C.CS_I_CODE inner join PRODUCT_MASTER PROD on S.SIM_I_CODE=PROD.PROD_I_CODE inner join CUSTOMER_WEEKLY_PLAN CWP ON I.I_CODE=CWP.CWP_I_CODE WHERE " + StrCond + " CWP_WEEK='" + WeekCond + "' AND PROD.PROD_MACHINE_LOC in('INHOUSE','BOTH') and PROD.ES_DELETE=0 and S.ES_DELETE=0 AND CWP.ES_DELETE=0 AND I.ES_DELETE=0 AND G.ES_DELETE=0 AND PROD.ES_DELETE=0 AND S.SIM_COMP_ID='" + Convert.ToInt32(Session["CompanyId"]) + "' and CWP.CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' group by G.GP_NAME,I.I_CODE,I_CODENO,CWP_P_CODE,I_NAME,CWP_WEEK,SIM_CUST_STOCK,SIM_FINISH_GOODS,SIM_RFM_STORE,right(convert(varchar,CWP.CWP_DATE,106),8),SIM_RFI_STORE) AS tEMP select GP_NAME,I_CODE,I_CODENO,I_NAME,case when SALE_PLAN_QTY<0 then 0 else SALE_PLAN_QTY end as SALE_PLAN_QTY,Tot_Stnd_Stock,CASE WHEN ActualStockQty<0 THEN 0 ELSE ActualStockQty END AS ActualStockQty,CWP_WEEK,CWP_DATE,STD_StockInFG,CASE WHEN Actual_Stock_InFG<0 THEN 0 ELSE Actual_Stock_InFG END AS Actual_Stock_InFG,Std_Stock_RFI,CASE WHEN Actual_Stock <0 THEN 0 ELSE Actual_Stock END AS Actual_Stock,Std_Stock_RFM,CASE WHEN Actual_StockRFM<0 THEN 0 ELSE Actual_StockRFM END AS Actual_StockRFM into #Temp2 from #Temp select GP_NAME,I_CODE,I_CODENO,I_NAME,round(isnull(round(isnull(SALE_PLAN_QTY,0),0) + STD_StockInFG - Actual_Stock_InFG,0),0) as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,CWP_DATE as [MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp3 from #Temp2 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else round(isnull(([Dispatch_Plan_Of_Machine]+Std_Stock_RFI-Actual_Stock),0),0) end as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,[MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp4 from #Temp3 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else isnull([Dispatch_Plan_Of_Machine],0) end as [Dispatch_Plan_Of_Machine],CWP_WEEK,[MONTH] as [Month],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFM as Std_Stock_RFI,Actual_StockRFM as Actual_Stock from #Temp4 drop table #Temp drop table #Temp2 drop table #Temp3 drop table #Temp4";
                ReportName = "CastingsReqFromRFMforMachine";
            }
            else
            {
                Title = "Castings Required To RFM From Foundry (For Vendor)";
                lblTitle.Text = "Castings Required To RFM From Foundry (For Vendor)";
                Query = "SELECT * INTO #Temp from (SELECT DISTINCT G.GP_NAME,I.I_CODE,I_CODENO,I_NAME,isnull((select sum(isnull(CWP_SALE_QTY,0)) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE AND CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) as SALE_PLAN_QTY,ISNULL(SIM_CUST_STOCK,0) as Tot_Stnd_Stock,isnull((select isnull(sum(CWP_CUSTOMER_STOCK),0) from CUSTOMER_WEEKLY_PLAN where CWP_I_CODE=I.I_CODE and CUSTOMER_WEEKLY_PLAN.ES_DELETE=0 and CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' AND CWP_WEEK=CWP.CWP_WEEK),0) AS ActualStockQty,isnull(SIM_FINISH_GOODS,0) as STD_StockInFG,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483642' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock_InFG,isnull(SIM_RFI_STORE,0) as Std_Stock_RFI,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483643' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_Stock,isnull(SIM_RFM_STORE,0) as Std_Stock_RFM,ISNULL((select SUM(ISNULL(STL_DOC_QTY,0)) AS STL_DOC_QTY from STOCK_LEDGER WHERE STL_STORE_TYPE = '-2147483645' AND STL_I_CODE= I.I_CODE and STL_DOC_DATE<'" + dtMonth.ToString("dd/MMM/yyyy") + "'),0) as Actual_StockRFM,case when CWP_WEEK='1' then 'Week :1' when CWP_WEEK='2' then 'Week :2' when CWP_WEEK='3' then 'Week :3' when CWP_WEEK='4' then 'Week :4' else '0' end As CWP_WEEK,right(convert(varchar,CWP.CWP_DATE,106),8) as CWP_DATE FROM GROUP_MASTER G INNER JOIN STANDARD_INVENTARY_MASTER S ON G.GP_CODE =S.SIM_GP_CODE INNER JOIN ITEM_MASTER I ON S.SIM_I_CODE=I.I_CODE INNER JOIN CUSTOMER_SCHEDULE C ON SIM_I_CODE=C.CS_I_CODE inner join PRODUCT_MASTER PROD on S.SIM_I_CODE=PROD.PROD_I_CODE inner join CUSTOMER_WEEKLY_PLAN CWP ON I.I_CODE=CWP.CWP_I_CODE WHERE " + StrCond + " CWP_WEEK='" + WeekCond + "' AND PROD.PROD_MACHINE_LOC in('OFFLOADED','BOTH') and PROD.ES_DELETE=0 and S.ES_DELETE=0 AND CWP.ES_DELETE=0 AND I.ES_DELETE=0 AND G.ES_DELETE=0 AND PROD.ES_DELETE=0 AND S.SIM_COMP_ID='" + Convert.ToInt32(Session["CompanyId"]) + "' and CWP.CWP_DATE='" + dtMonth.ToString("dd/MMM/yyyy") + "' group by G.GP_NAME,I.I_CODE,I_CODENO,CWP_P_CODE,I_NAME,CWP_WEEK,SIM_CUST_STOCK,SIM_FINISH_GOODS,SIM_RFM_STORE,right(convert(varchar,CWP.CWP_DATE,106),8),SIM_RFI_STORE) AS tEMP select GP_NAME,I_CODE,I_CODENO,I_NAME,case when SALE_PLAN_QTY<0 then 0 else SALE_PLAN_QTY end as SALE_PLAN_QTY,Tot_Stnd_Stock,CASE WHEN ActualStockQty<0 THEN 0 ELSE ActualStockQty END AS ActualStockQty,CWP_WEEK,CWP_DATE,STD_StockInFG,CASE WHEN Actual_Stock_InFG<0 THEN 0 ELSE Actual_Stock_InFG END AS Actual_Stock_InFG,Std_Stock_RFI,CASE WHEN Actual_Stock <0 THEN 0 ELSE Actual_Stock END AS Actual_Stock,Std_Stock_RFM,CASE WHEN Actual_StockRFM<0 THEN 0 ELSE Actual_StockRFM END AS Actual_StockRFM into #Temp2 from #Temp select GP_NAME,I_CODE,I_CODENO,I_NAME,round(isnull(round(isnull(SALE_PLAN_QTY,0),0) + STD_StockInFG - Actual_Stock_InFG,0),0) as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,CWP_DATE as [MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp3 from #Temp2 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else round(isnull(([Dispatch_Plan_Of_Machine]+Std_Stock_RFI-Actual_Stock),0),0) end as [Dispatch_Plan_Of_Machine],Tot_Stnd_Stock,ActualStockQty,CWP_WEEK,[MONTH],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFI,Actual_Stock,Std_Stock_RFM,Actual_StockRFM into #Temp4 from #Temp3 select GP_NAME,I_CODE,I_CODENO,I_NAME,case when [Dispatch_Plan_Of_Machine]<0 then 0 else isnull([Dispatch_Plan_Of_Machine],0) end as [Dispatch_Plan_Of_Machine],CWP_WEEK,[MONTH] as [Month],STD_StockInFG,Actual_Stock_InFG,Std_Stock_RFM as Std_Stock_RFI,Actual_StockRFM as Actual_Stock from #Temp4 drop table #Temp drop table #Temp2 drop table #Temp3 drop table #Temp4";
                ReportName = "CastingsReqFromRFMforMachine";
            }
            DataSet ds = new DataSet();
            DataTable dt = new DataTable();
            dt = CommonClasses.Execute(Query);
            if (dt.Rows.Count > 0)
            {
                Report(ReportName, dt, Title, Session["CompanyName"].ToString(), dtMonth.ToString("dd/MMM/yyyy"));
            }
            else
            {
                PanelMsg.Visible = true;
                lblmsg.Text = "Record Not Found";
                return;
            }
        }
        catch (Exception Ex)
        {
        }
    }
    #endregion

    #region Report
    public void Report(string ReportName, DataTable dt, string Title, string CompanyName, string Par)
    {
        ReportDocument rptname = null;
        rptname = new ReportDocument();
        rptname.Load(Server.MapPath("~/PPC/Reports/" + ReportName + ".rpt")); //rptCastReqFromRFMForMachine
        rptname.FileName = Server.MapPath("~/PPC/Reports/" + ReportName + ".rpt");
        rptname.Refresh();
        rptname.SetDataSource(dt);
        rptname.SetParameterValue("Title", Title);
        rptname.SetParameterValue("txtCompName", CompanyName);
        rptname.SetParameterValue("txtDate", Par);
        CrystalReportViewer1.ReportSource = rptname;
    }
    #endregion Report

    #region ShowMessage
    public bool ShowMessage(string DiveName, string Message, string MessageType)
    {
        try
        {
            if ((!ClientScript.IsStartupScriptRegistered("regMostrarMensagem")))
            {
                Page.ClientScript.RegisterStartupScript(this.GetType(), "regMostrarMensagem", "MostrarMensagem('" + DiveName + "','" + Message + "','" + MessageType + "');", true);
            }
            return true;
        }
        catch (Exception Ex)
        {
            CommonClasses.SendError("Foundry Capacity Booking Summary", "ShowMessage", Ex.Message);
            return false;
        }
    }
    #endregion

    #region btnCancel_Click
    protected void btnCancel_Click(object sender, EventArgs e)
    {
        try
        {
            if (Type.ToString() == "Machine")
            {
                Response.Redirect("~/PPC/ReportForms/VIEW/DailySalePerfView.aspx", false);
            }
            else
            {
                Response.Redirect("~/PPC/ReportForms/VIEW/ViewCastingsrequriedfromrfmforvendorReport.aspx", false);
            }
        }
        catch (Exception Ex)
        {
            CommonClasses.SendError("Vendor Schedule Report", "btnCancel_Click", Ex.Message);
        }
    }
    #endregion
}
